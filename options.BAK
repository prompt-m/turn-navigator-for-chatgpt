<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChatGPT Turn Navigator 設定</title>
  <style>

    :root { --fg:#111; --muted:#666; --bd:#ddd; --bg:#fff; --pill:#f5f6f8; }
    :root{ --pins-h: 360px; }                 /* 好みで 300–480px */
    @media (prefers-color-scheme: dark){
      :root { --fg:#e7e7ea; --muted:#aaa; --bd:#3a3a3f; --bg:#1f1f22; --pill:#2a2a2d; }
    }
    body{ margin:24px; font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--fg); background:var(--bg); }
    h1{ font-size:28px; margin:0 0 6px; }
    .desc{ color:var(--muted); margin:0 0 18px; }
    .card{
      border:1px solid var(--bd);
      border-radius:14px;
      padding:16px;
      background:var(--pill);
      position: relative;
      padding-top: 48px;
    }
    .group{ margin:18px 0 0; }
    .row{
      display: grid;
      grid-template-columns: minmax(180px, 30%) 1fr;  /* ← 可変幅に */
      grid-template-columns: minmax(180px, 30%) 1fr;  /* ← 左30%/右70% */
      gap: 14px;
      align-items: center;
      padding: 12px 0;
      border-top: 1.5px dashed color-mix(in srgb, var(--bd) 60%, transparent);
    }
    .row:first-child{ border-top:none; padding-top:0; }
    label b{ font-weight:700; }
    input[type="number"]{ width:180px; padding:8px 10px; border-radius:10px; border:1px solid var(--bd); background:var(--bg); color:var(--fg); }
    input[type="checkbox"]{ cursor:pointer; }
    .hint{ color:var(--muted); font-size:14px; }
    .actions{ display:flex; gap:10px; margin-top:18px; align-items:center; }
    button{
      all:unset; display:inline-grid; place-items:center; padding:4px 18px;
      border-radius:10px; border:1px solid var(--bd); cursor:pointer; background:#f2f2f7;
      box-shadow: 0 6px 24px rgba(0,0,0,.18);          /* ← ナビに寄せた影 */
    }
    button:hover { opacity: 1; background: #fff; }

    @media (prefers-color-scheme: dark){
      button{ background:#3a3a40; box-shadow: 0 6px 24px rgba(0,0,0,.28); }
    }
    .pins-island{
      grid-column: 1 / -1;
      background: var(--bg);
      border: 1px solid var(--bd);
      border-radius: 12px;
      padding: 10px 12px;
    }
    .pins-wrap{
      max-height: var(--pins-h);
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-gutter: stable;               /* 横ズレ防止 */
    }
    .pins-wrap thead th{
      position: sticky; top: 0;
      background: var(--pill);
      z-index: 1;
    }
    @media (max-width: 720px){
      :root{ --pins-h: min(50vh, 360px); }
    }

    /* 付箋テーブル */
    .cgtn-pins-table{ width:100%; border-collapse:collapse; font-size:13px; }
    .cgtn-pins-table th, .cgtn-pins-table td{ border-bottom:1px solid rgba(0,0,0,.08); padding:6px 8px; }
    .cgtn-pins-table .ops button{ padding:4px 8px; cursor:pointer; }
    .cgtn-pins-table tr:hover{ background:rgba(0,0,0,.03); }
    .cgtn-pins-table tr[data-count="0"]{ opacity:.6; }
    .pins-table{
      display:grid;
      grid-template-columns: 1fr 7rem 12rem 6rem; /* チャット / 付箋数 / 更新 / 操作 */
      gap:10px 16px;
      align-items:center;
    }
    .pins-table .hd{ font-weight:600; opacity:.8; }
    .pins-table .row{ display:contents; } /* 各行＝4セル */
    .pins-table .ops button{ width:100%; }
    @media (max-width: 720px){
      .pins-table{ grid-template-columns: 1fr 5rem 9rem 5rem; }
    }
    /* 右上に貼り付け。枠の内側に少し余白 */
    .lang-switch{
      position: absolute;
      top: 10px;                       /* 枠の上端からの距離 */
      right: 12px;                     /* 枠の右端からの距離 */
      display: flex;
      gap: 8px;
      z-index: 1;                      /* テーブルより前面に */
    }
    /* クション行（保存・リセット）を常に見えるように */
    .actions{
      position: sticky; bottom: 0;
      background: var(--pill);
      padding: 12px 0;
      border-top: 1px solid var(--bd);
      display: flex; gap: 10px; align-items: center;
    }
    .group{ margin: 18px 0 0; }
    details{ background: transparent; }
    details[open] summary{ margin-bottom: 8px; }

    /* セクション(=details.row)のまとめ用ラッパ */
    .section { display:grid; gap:10px; }
    .section .row{ border-top:none; padding:0; }
    
    /* details要素のsummaryを“見出しバー”っぽく、上下の無駄を詰める */
    details.row > summary{
      list-style:none; cursor:pointer;
      margin: 0 -8px 6px; padding: 6px 8px;
      border-radius: 8px;
      background: color-mix(in srgb, var(--pill) 86%, var(--bd) 14%);
      font-weight: 600;
    }

    /* セクション末尾のボタン帯（スクロールに流されにくい軽いスティッキー） */
    .section-actions{
      position: sticky; bottom: -4px;
      display:flex; gap:8px; align-items:center;
      padding: 8px 0 0;
      background: linear-gradient(to top, var(--pill) 70%, transparent);
    }

    .section-actions button {
      all: revert;                    /* ← 「全リセット解除」これで一気に元のボタン仕様を戻す */
      font: inherit;
      padding: 6px 18px;
      border-radius: 10px;
      border: 1px solid var(--bd);
      background: var(--pill);
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,.12);
    }
    .section-actions button:hover {
      background: color-mix(in srgb, var(--pill) 90%, var(--fg) 10%);
    }

    .section-actions{ display:flex; gap:8px; align-items:center; }
    .section-actions .msg-inline{
      margin-left: 6px; font-size: 14px; color: var(--muted);
      opacity: 0; transition: opacity .15s ease;
    }
    .section-actions .msg-inline.show{ opacity: 1; }

    #msg-pins {
      opacity: 0;
      transition: opacity .25s ease;
      color: var(--muted);
      margin-top: 6px;
    }
    #msg-pins.show {
      display: block;
      opacity: 1;
    }
    #cgtn-floater{
      position: fixed;
      inset: 0;                   /* 画面全体を覆うが pointer-events: none で邪魔しない */
      pointer-events: none;
      z-index: 9999;
    }
    .cgtn-toast{
      position: absolute;
      max-width: 52ch;
      background: #111;          /* ダーク/ライト両対応の無難色にしたいなら var(--fg)/--bg で調整 */
      color: #fff;
      font-size: 14px;
      line-height: 1.4;
      padding: 8px 12px;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,.25);
      opacity: 0;
      transform: translate(-50%,-50%) scale(.98);
      transition: opacity .18s ease, transform .18s ease;
    }
    .cgtn-toast.show{
      opacity: 1;
      transform: translate(-50%,-50%) scale(1);
    }
    @media (prefers-color-scheme: dark){
      .cgtn-toast{ background:#222; color:#e7e7ea; }
    }


  </style>

</head>
<body>
  <h1 id="opt-title" data-i18n="opts.title"></h1>
  <p class="desc" id="opt-desc" data-i18n="opts.tips"></p>

  <form id="cgtn-options" class="card" autocomplete="off">

  <div class="lang-switch">
    <button id="lang-ja" data-i18n="opts.lang.ja" type="button"></button>
    <button id="lang-en" data-i18n="opts.lang.en" type="button"></button>
  </div>


  <div class="group">
    <!-- ===== メイン1：付箋データ管理 ===== -->
    <details class="row" id="pins-section" open="false" style="grid-column:1 / -1;">
      <summary style="cursor:pointer;"><b id="pins-title" data-i18n="options.pinsTitle"></b></summary>
      <p class="hint" id="pins-hint" data-i18n="options.pinsHint" style="margin-top:6px;"></p>
      <p class="desc hint" id="msg-pins"></p>
      <div class="row" style="border-top:none;">
        <div class="pins-island">
          <div class="pins-wrap">
            <div id="pins-table"></div>
          </div>
      </div>
    </details>

    <!-- ===== メイン2：一覧パネルの表示設定 ===== -->
    <details class="row" open="false" style="grid-column:1 / -1;">
      <!--一覧パネル-->
      <summary style="cursor:pointer;"><b id="sum-list" data-i18n="options.listTitle"></b></summary>
      <div class="section" style="padding-top:10px;display:grid;gap:10px;">
        <div class="row" style="border-top:none;padding:0;">
          <!--1行の最大文字数-->
          <label for="listMaxChars"><b id="lbl-listMaxChars" data-i18n="options.listMaxChars"></b></label>
          <input id="listMaxChars" name="listMaxChars" type="number" min="10" max="200" step="1" />
        </div>
        <div class="row" style="border-top:none;padding:0;">
          <!--フォントサイズ(px)-->
          <label for="listFontSize"><b id="lbl-listFontSize"></b></label>
          <input id="listFontSize" name="listFontSize" data-i18n="options.listFontSize" type="number" min="8" max="24" step="1" />
        </div>
        <!-- このセクション専用のボタン帯 -->
        <div class="section-actions">
          <button id="saveList"  type="button" data-i18n="options.saveBtn"></button>
          <button id="resetList" type="button" data-i18n="options.resetBtn"></button>
          <span class="msg-inline" id="msg-list" aria-live="polite"></span>
        </div>
      </div>
    </details>

    <!-- ===== 詳細設定（折りたたみ） ===== -->
    <details class="row" open="false" style="grid-column:1 / -1;">
      <!--詳細設定（基準線とスクロール挙動）-->
      <summary style="cursor:pointer;"><b id="sum-advanced" data-i18n="options.detailTitle"></b></summary>
        <div class="section" style="padding-top:10px;display:grid;gap:10px;">
          <!-- 基準線：ON/OFF -->
          <div class="row">
            <!--基準線の表示-->
            <label for="showViz"><b id="lbl-showViz" data-i18n="nav.viz"></b></label>
            <label style="display:inline-flex;gap:8px;align-items:center;cursor:pointer;">
              <input id="showViz" name="showViz" type="checkbox" />
              <span id="hint-showViz" class="hint" data-i18n="nav.viz"></span>
            </label>
          </div>

          <!-- Center Bias -->
          <div class="row">
            <label for="centerBias"><b id="lbl-centerBias" data-i18n="options.centerBias"></b></label>
            <div>
              <input id="centerBias" name="centerBias" type="number" step="0.01" min="0" max="1" />
              <div class="hint" id="hint-centerBias" data-i18n="options.centerBiasHint"></div>
            </div>
          </div>

          <div class="row">
            <!--ゆらぎ幅 (EPS Hysteresis)-->
            <label for="eps"><b id="lbl-eps" data-i18n="options.eps"></b></label>
            <div>
              <input id="eps" name="eps" type="number" step="1" min="0" max="120" />
              <!--「同じ記事とみなす」幅。小さい=敏感 / 大きい=安定。目安 5–50。-->
              <div class="hint" id="hint-eps" data-i18n="options.epsHint"></div>
            </div>
          </div>

          <!-- その他の挙動 -->
          <div class="row">
            <!--スクロールロック (ms)-->
            <label for="lockMs"><b id="lbl-lockMs" data-i18n="options.lockMs"></b></label>
            <input id="lockMs" name="lockMs" type="number" step="10" min="0" max="3000" />
          </div>

          <!-- このセクション専用のボタン帯 -->
          <div class="section-actions">
            <button id="saveAdv"  type="button" data-i18n="options.saveBtn"></button>
            <button id="resetAdv" type="button" data-i18n="options.resetBtn"></button>
            <span class="msg-inline" id="msg-adv" aria-live="polite"></span>
          </div>
        </div>
    </details>
    </div>
  </form>
  <script src="i18n.js"></script>
  <script src="shared.js"></script>
  <script src="options.js"></script>

  <footer><p class="desc hint" id="buildInfo" style="margin-top:12px;"></p></footer>
  <div id="cgtn-floater" aria-live="polite" aria-atomic="true"></div>
</body>
</html>
